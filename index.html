<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Joguinho</title>
	<style>
		
		canvas {
			border: 1px solid black;
			position: absolute;
			top: 0px;
			bottom: 0px;
			left: 0px;
			right: 0px;
			margin: auto;
		}
		
		.botao {
		width: 20px;
		height: 20px;
		
		}

	</style>
</head>
<body>
	<input type="button" value="Pular" onclick="clique()" class='botao'>

	<script>

		// VARIAVEIS
		var canvas, contexto, ALTURA, LARGURA, frames = 0, velocidade=10, estadoAtual,

		estados = {
			jogar:0,
			jogando: 1,
			perdeu: 2
		},

		chao={
			y:530,
			altura:70,
			cor: '#e8da78',

			desenha: function(){
				contexto.fillStyle = this.cor;
				contexto.fillRect(0, this.y, LARGURA, this.altura);
			},
		},

		bloco={
			x:50,
			y:0,
			altura:50,
			largura:50,
			cor: '#ff9239',
			gravidade: 1.5,
			queda: 0,
			forcaDoPulo: 14,
			morreu: false,
			score: 0,

			atualiza: function() {
				this.queda += this.gravidade;
				this.y += this.queda;

				if (this.y > ALTURA/2 && estadoAtual == estados.jogar){
					this.y=ALTURA/2
					this.morreu=false
					this.queda = 0
				}

				else if (this.y > chao.y - this.altura && estadoAtual != estados.perdeu) {
					this.morreu = true;
					this.y = chao.y - this.altura;
					this.queda = 0;

				};
			},

			desenha: function(){
				if (this.morreu == false){
					contexto.fillStyle = this.cor;
				}
				else
					contexto.fillStyle='#000000';
				contexto.fillRect(this.x, this.y, this.largura, this.altura);
			},

			reset: function(){
				this.queda=0;
				this.y=0;
				this.score = 0;
				this.morreu = false
			},

			pula: function(){
				this.queda = -this.forcaDoPulo;
				this.morreu = false;
			},

		};

		obstaculos={
			_obs:[],
			cores: ['#ffbc1c','#ff1c1c','#ff85e1','#52a7ff','#78ff5d'],
			tempoInsere:0,

			insere: function(){
				this._obs.push({
					x: LARGURA,
					largura: 50,
					altura_baixo: 30 + Math.floor(120*Math.random()),
					espaco: 130+ Math.floor(50*Math.random()),
					cor: this.cores[Math.floor(5*Math.random())]

				});

				this.tempoInsere=20+Math.floor(40*Math.random());
			},

			atualiza: function(){
				if(this.tempoInsere == 0)
					this.insere()
				else
					this.tempoInsere-- 
				for (var i=0, tam=this._obs.length; i<tam; i++){
					var obs=this._obs[i];
					obs.x-=velocidade;

					if(bloco.x < obs.x + obs.largura && bloco.x+bloco.largura >= obs.x && bloco.y + bloco.altura >= chao.y - obs.altura_baixo){
						bloco.morreu = true;
						estadoAtual=estados.perdeu;
					}

					else if (bloco.x < obs.x + obs.largura && bloco.x+bloco.largura >= obs.x && bloco.y <= chao.y-obs.altura_baixo-obs.espaco){
						estadoAtual=estados.perdeu;
						bloco.morreu = true;
					}

					else if (bloco.morreu == true) {
						estadoAtual=estados.perdeu;
					}


					else if (obs.x <= -obs.largura){
						this._obs.splice(i, 1);
						tam--;
						bloco.score++;
						i--
					}
				};
			},

			limpa: function(){
				this._obs = [];
			},

			desenha: function(){
				for (var i=0, tam=this._obs.length; i< tam; i++){
					var obs=this._obs[i];
					contexto.fillStyle=obs.cor;
					contexto.fillRect(obs.x, chao.y-obs.altura_baixo, obs.largura, obs.altura_baixo);
					contexto.fillStyle=obs.cor;
					contexto.fillRect(obs.x,0, obs.largura, chao.y-obs.altura_baixo-obs.espaco);
				};
			}
		};

		// FUNÇÕES 

		function clique(evento){
			if (estadoAtual == estados.jogando){
				bloco.pula();
			}
			else if (estadoAtual == estados.jogar){
				estadoAtual=estados.jogando;
				bloco.reset()
			}
			else if (estadoAtual == estados.perdeu && bloco.y >= 2*ALTURA){
				estadoAtual=estados.jogar;
				obstaculos.limpa();
				bloco.queda=0;
				bloco.morre=true;
			}
		};

		function main(){
			LARGURA = window.innerWidth;
			ALTURA = window.innerHeight;
			if (LARGURA >= 500){
				ALTURA = 600;
				LARGURA = 600;
			};

			canvas = document.createElement('canvas');
			canvas.width = LARGURA;
			canvas.height = ALTURA;

			contexto = canvas.getContext('2d');
			document.body.appendChild(canvas);
			canvas.addEventListener('mousedown', clique);

			estadoAtual=estados.jogar
			roda();

		};

		function roda(){
			atualiza();
			desenha();

			// LOOP
			window.requestAnimationFrame(roda);
		};

		function atualiza(){
			frames++;
			bloco.atualiza();
			if (estadoAtual == estados.jogando){
				obstaculos.atualiza();
			}

		};

		function desenha(){
			contexto.fillStyle = '#80daff';
			contexto.fillRect(0, 0, LARGURA, ALTURA);

			contexto.fillStyle='#FFFFFF';
			contexto.font='50px Verdana';
			contexto.fillText(bloco.score, 30,68)

			if (estadoAtual == estados.jogar){
				contexto.fillStyle='#000000';
				contexto.font='50px Verdana';
				contexto.fillText('RAMO JOGAR', 40,ALTURA/2)
				}

			else if (estadoAtual == estados.perdeu){
				contexto.fillStyle='#FF0000';
				contexto.font='50px Verdana';
				contexto.fillText('IHHH MORREU', 30,ALTURA/2)
			}

			else if (estadoAtual == estados.jogando)
				obstaculos.desenha();

			chao.desenha();
			bloco.desenha();

		};

		// RODA O JOGO
		main()
	</script>

</body>
</html>
